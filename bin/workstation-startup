#!/bin/bash

while true; do
  echo -e "GET http://google.com HTTP/1.0\n\n" | nc google.com 80 > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    ps -ef | egrep "[g]uake" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
      ssh-add-persistently work/dev-test1;
      ssh-add-persistently openstack/openstack-guest
      guake-setup;
      update-atom-ftpconfig /home/jonathanb/project-environments/dev-test1/.ftpconfig
      sleep 3;
      ssh-add -D;
      ssh-add-persistently \
        personal/github \
        work/gitlab.imhdev.com \
        openstack/openstack-guest \
        openstack/openstack-instance-key;
      exit 0;
    else
      echo "Refusing to setup your workstation because guake isnt running!";
      exit 255;
    fi;
  else
    read -p "You are off-line.  Attempt connect via ethernet? " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        sudo ip link set dev enp0s31f6 up;
        sudo dhclient;
        echo "Please run this script again.";
        exit 0;
    else
      echo "Refusing to setup your workstation because you are offline!";
      exit 255;
    fi;
  fi;
done;

